Взаимосвязь классов
===================

В проекте CinemaRentalSystem приложение построено по паттерну MVVM. Класс Program содержит точку входа Main и создает конфигурацию Avalonia через BuildAvaloniaApp, после чего управление передается классу App. В App в методе OnFrameworkInitializationCompleted создается главное окно MainWindow, и ему назначается контекст данных DataContext = MainWindowViewModel. Таким образом, MainWindow “привязан” к MainWindowViewModel и получает от него текущий экран, команды и данные для отображения.

Класс MainWindowViewModel является центральной ViewModel приложения и наследуется от ViewModelBase. Внутри он хранит единственный экземпляр DataStorage, который выступает сервисом доступа к данным (загрузка/сохранение и CRUD). Также MainWindowViewModel создает и хранит дочерние ViewModel: CinemasViewModel, SuppliersViewModel, FilmsViewModel, RentalsViewModel. Переключение между ними выполняется через команды ShowCinemasCommand / ShowSuppliersCommand / ShowFilmsCommand / ShowRentalsCommand, а активная ViewModel хранится в свойстве CurrentView.

Для связывания ViewModel и соответствующих View используется ViewLocator (IDataTemplate). Он проверяет, что объект является ViewModelBase, и по соглашению об именах (замена суффикса ViewModel на View) создает нужный UserControl/Window, назначая ему DataContext равный переданной ViewModel. Благодаря этому, при смене CurrentView интерфейс автоматически показывает нужное представление без ручного создания окон и контролов.

Все ViewModel (CinemasViewModel, SuppliersViewModel, FilmsViewModel, RentalsViewModel) наследуются от ViewModelBase, который реализует INotifyPropertyChanged и предоставляет общий механизм SetProperty/OnPropertyChanged. Команды во ViewModel реализованы через RelayCommand, который реализует интерфейс ICommand и инкапсулирует делегаты Execute/CanExecute. При изменении редактируемых полей ViewModel вызывает RaiseCanExecuteChanged, чтобы UI обновил доступность кнопок (например, “Добавить”/“Сохранить”).

Модели предметной области Cinema, Supplier, Film и Rental также реализуют INotifyPropertyChanged и имеют private-поля с публичными свойствами. Это позволяет интерфейсу отслеживать изменения и обновляться. Связи между моделями выражены идентификаторами: Film содержит SupplierId (поставщик фильма), а Rental содержит CinemaId и FilmId (какой кинотеатр арендует какой фильм). В RentalsViewModel и FilmsViewModel эти связи “разрешаются” в реальные объекты через выбор из коллекций (SelectedCinema/SelectedFilm/SelectedSupplier) и вспомогательные методы для отображения названий (GetCinemaName/GetFilmTitle/GetSupplierName).

DataStorage хранит все данные в объекте DataContainer (списки Cinemas/Suppliers/Films/Rentals) и отвечает за сериализацию/десериализацию в JSON. При изменениях через Add/Update/Delete соответствующей сущности DataStorage сохраняет данные на диск. Таким образом, ViewModel не работают с файлами напрямую: они обращаются к DataStorage как к единому источнику данных, а тот обеспечивает постоянство хранения.

Корректность ввода обеспечивается классом Validator (static). В ViewModel при изменении редактируемой сущности (EditingCinema/EditingSupplier/EditingFilm/EditingRental) выполняется проверка отдельных полей (ValidateField) и общей валидности (ValidateAll). Validator предоставляет как методы проверки (например, ValidateINN, ValidateAccountNumber), так и готовые сообщения об ошибках, которые ViewModel сохраняют в свойствах *Error. Эти свойства затем используются в интерфейсе для отображения подсказок и блокировки выполнения команд.

В проекте FilmManagementSystem архитектура проще и ориентирована на консольное управление. Класс Program хранит статическое поле dataManager типа DataManager и в Main запускает главный цикл меню, который вызывает операции управления поставщиками и фильмами. DataManager хранит внутри списки List<Supplier> и List<Film>, а также отвечает за загрузку/сохранение в текстовые файлы suppliers.txt и films.txt. Связь фильма и поставщика реализована целочисленным SupplierId внутри Film: при выводе списка фильмов Program обращается в DataManager за поставщиком по этому идентификатору (GetSupplierById) и выводит его имя. Сами классы Film и Supplier предоставляют методы ToFileString/FromFileString для преобразования в строку и восстановления из строки файла, что позволяет DataManager сохранять и загружать объекты без использования внешних библиотек.


