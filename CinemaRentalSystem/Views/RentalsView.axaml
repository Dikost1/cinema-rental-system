<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:vm="using:CinemaRentalSystem.ViewModels"
             mc:Ignorable="d" d:DesignWidth="1100" d:DesignHeight="650"
             x:Class="CinemaRentalSystem.Views.RentalsView"
             x:DataType="vm:RentalsViewModel">

    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="2*"/>
            <ColumnDefinition Width="3*"/>
        </Grid.ColumnDefinitions>

        <!-- Список аренд -->
        <Border Grid.Column="0" BorderBrush="#BDC3C7" BorderThickness="1" Margin="5" CornerRadius="5">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <TextBlock Grid.Row="0" 
                           Text="Список аренд" 
                           FontSize="16" 
                           FontWeight="Bold" 
                           Margin="10"
                           Foreground="#2C3E50"/>

                <ListBox Grid.Row="1" 
                         ItemsSource="{Binding Rentals}"
                         SelectedItem="{Binding SelectedRental}"
                         Margin="5"
                         Background="#ECF0F1">
                    <ListBox.ItemTemplate>
                        <DataTemplate>
                            <StackPanel Margin="5">
                                <TextBlock FontWeight="SemiBold" FontSize="14">
                                    <Run Text="Демонстрация: "/>
                                    <Run Text="{Binding DemonstrationStartDate, StringFormat='{}{0:dd.MM.yyyy}'}"/>
                                    <Run Text=" - "/>
                                    <Run Text="{Binding DemonstrationEndDate, StringFormat='{}{0:dd.MM.yyyy}'}"/>
                                </TextBlock>
                                <TextBlock FontSize="12" Foreground="#27AE60">
                                    <Run Text="Оплата: "/>
                                    <Run Text="{Binding RentalPayment, StringFormat='{}{0:N2} ₽'}"/>
                                </TextBlock>
                                <TextBlock FontSize="11" Foreground="#E74C3C" IsVisible="{Binding LateFee}">
                                    <Run Text="Пени: "/>
                                    <Run Text="{Binding LateFee, StringFormat='{}{0:N2} ₽'}"/>
                                </TextBlock>
                            </StackPanel>
                        </DataTemplate>
                    </ListBox.ItemTemplate>
                </ListBox>
            </Grid>
        </Border>

        <!-- Форма редактирования -->
        <Border Grid.Column="1" BorderBrush="#BDC3C7" BorderThickness="1" Margin="5" CornerRadius="5">
            <ScrollViewer>
                <StackPanel Margin="10">
                    <TextBlock Text="Информация об аренде киноленты" 
                               FontSize="16" 
                               FontWeight="Bold" 
                               Margin="0,0,0,15"
                               Foreground="#2C3E50"/>
                    
                    <TextBlock Text="Один кинотеатр может одновременно арендовать несколько кинолент" 
                               FontSize="11" 
                               FontStyle="Italic"
                               Margin="0,0,0,10"
                               Foreground="#7F8C8D"/>

                    <!-- Общее сообщение об ошибке -->
                    <Border Background="#FFE6E6" 
                            BorderBrush="#E74C3C" 
                            BorderThickness="1" 
                            CornerRadius="3" 
                            Padding="10" 
                            Margin="0,0,0,10"
                            IsVisible="{Binding HasErrorMessage}">
                        <TextBlock Text="{Binding ErrorMessage}" 
                                   Foreground="#C0392B" 
                                   TextWrapping="Wrap"/>
                    </Border>

                    <TextBlock Text="Кинотеатр:" Margin="0,5,0,2"/>
                    <ComboBox ItemsSource="{Binding Cinemas}"
                              SelectedItem="{Binding SelectedCinema, Mode=TwoWay}"
                              HorizontalAlignment="Stretch"
                              PlaceholderText="Выберите кинотеатр...">
                        <ComboBox.ItemTemplate>
                            <DataTemplate>
                                <StackPanel>
                                    <TextBlock Text="{Binding Name}" FontWeight="SemiBold"/>
                                    <TextBlock Text="{Binding Address}" FontSize="11" Foreground="#7F8C8D"/>
                                </StackPanel>
                            </DataTemplate>
                        </ComboBox.ItemTemplate>
                    </ComboBox>
                    <TextBlock Text="{Binding CinemaError}" 
                               Foreground="#E74C3C" 
                               FontSize="11" 
                               Margin="0,2,0,0"
                               IsVisible="{Binding HasCinemaError}"/>

                    <TextBlock Text="Фильм (кинолента):" Margin="0,10,0,2"/>
                    <ComboBox ItemsSource="{Binding Films}"
                              SelectedItem="{Binding SelectedFilm, Mode=TwoWay}"
                              HorizontalAlignment="Stretch"
                              PlaceholderText="Выберите фильм...">
                        <ComboBox.ItemTemplate>
                            <DataTemplate>
                                <StackPanel>
                                    <TextBlock Text="{Binding Title}" FontWeight="SemiBold"/>
                                    <StackPanel Orientation="Horizontal">
                                        <TextBlock Text="{Binding Category}" FontSize="11" Foreground="#7F8C8D"/>
                                        <TextBlock Text=" • " FontSize="11" Foreground="#7F8C8D"/>
                                        <TextBlock Text="{Binding ReleaseYear}" FontSize="11" Foreground="#7F8C8D"/>
                                    </StackPanel>
                                </StackPanel>
                            </DataTemplate>
                        </ComboBox.ItemTemplate>
                    </ComboBox>
                    <TextBlock Text="{Binding FilmError}" 
                               Foreground="#E74C3C" 
                               FontSize="11" 
                               Margin="0,2,0,0"
                               IsVisible="{Binding HasFilmError}"/>

                    <TextBlock Text="Дата начала демонстрации фильма:" Margin="0,10,0,2"/>
                    <DatePicker SelectedDate="{Binding EditingRental.DemonstrationStartDate, Mode=TwoWay}"
                                HorizontalAlignment="Stretch"/>
                    <TextBlock Text="{Binding DemonstrationStartError}" 
                               Foreground="#E74C3C" 
                               FontSize="11" 
                               Margin="0,2,0,0"
                               IsVisible="{Binding HasDemonstrationStartError}"/>

                    <TextBlock Text="Дата окончания демонстрации фильма:" Margin="0,10,0,2"/>
                    <DatePicker SelectedDate="{Binding EditingRental.DemonstrationEndDate, Mode=TwoWay}"
                                HorizontalAlignment="Stretch"/>
                    <TextBlock Text="{Binding DemonstrationEndError}" 
                               Foreground="#E74C3C" 
                               FontSize="11" 
                               Margin="0,2,0,0"
                               IsVisible="{Binding HasDemonstrationEndError}"/>

                    <TextBlock Text="Сумма оплаты за аренду ленты (руб.):" Margin="0,10,0,2"/>
                    <NumericUpDown Value="{Binding EditingRental.RentalPayment, Mode=TwoWay}" 
                                   Minimum="0" 
                                   Maximum="10000000"
                                   Increment="1000"
                                   FormatString="N2"
                                   Watermark="0.00"/>
                    <TextBlock Text="{Binding RentalPaymentError}" 
                               Foreground="#E74C3C" 
                               FontSize="11" 
                               Margin="0,2,0,0"
                               IsVisible="{Binding HasRentalPaymentError}"/>

                    <TextBlock Text="Пени за несвоевременный возврат (руб.):" Margin="0,10,0,2"/>
                    <NumericUpDown Value="{Binding EditingRental.LateFee, Mode=TwoWay}" 
                                   Minimum="0" 
                                   Maximum="10000000"
                                   Increment="100"
                                   FormatString="N2"
                                   Watermark="0.00"/>
                    <TextBlock Text="{Binding LateFeeError}" 
                               Foreground="#E74C3C" 
                               FontSize="11" 
                               Margin="0,2,0,0"
                               IsVisible="{Binding HasLateFeeError}"/>
                    <TextBlock Text="* Оставьте 0, если возврат был своевременным" 
                               FontSize="10" 
                               FontStyle="Italic"
                               Margin="0,2,0,0"
                               Foreground="#95A5A6"/>

                    <TextBlock Text="Примечания:" Margin="0,10,0,2"/>
                    <TextBox Text="{Binding EditingRental.Notes, Mode=TwoWay}" 
                             Watermark="Дополнительная информация..."
                             AcceptsReturn="True"
                             TextWrapping="Wrap"
                             Height="80"/>

                    <!-- Кнопки управления -->
                    <StackPanel Orientation="Horizontal" Margin="0,20,0,0" HorizontalAlignment="Center">
                        <Button Content="Добавить" 
                                Command="{Binding AddCommand}"
                                Background="#27AE60"
                                Foreground="White"
                                Padding="15,8"
                                Margin="5"/>
                        
                        <Button Content="Обновить" 
                                Command="{Binding UpdateCommand}"
                                Background="#3498DB"
                                Foreground="White"
                                Padding="15,8"
                                Margin="5"/>
                        
                        <Button Content="Удалить" 
                                Command="{Binding DeleteCommand}"
                                Background="#E74C3C"
                                Foreground="White"
                                Padding="15,8"
                                Margin="5"/>
                        
                        <Button Content="Очистить" 
                                Command="{Binding ClearCommand}"
                                Background="#95A5A6"
                                Foreground="White"
                                Padding="15,8"
                                Margin="5"/>
                    </StackPanel>
                </StackPanel>
            </ScrollViewer>
        </Border>
    </Grid>
</UserControl>
